name: Create artefact

on:
  push:
    branches: [ develop ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
      # the output of this is only the tag, but you don't need check
      - id: pipelineRelease
        uses: pozetroninc/github-action-get-latest-release@master
        with:
          owner: sonomirco
          repo: Pipeline
          excludes: prerelease, draft
    
      - name: ðŸ›Ž Checkout repo
        uses: actions/checkout@v2
        with: 
          fetch-depth: 0
          
      - name: Get release
        id: get_release
        uses: bruceadams/get-release@v1.2.2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: 7Zip server
        run: 7z a -o${{ github.workspace }} -t7z -mx=9 artifact.7z ./bin/Debug/net5.0
      
      - name: ðŸ“œ Display
        run: |
          echo ${{ github.ref }}
          echo ${{ steps.pipelineRelease.outputs.release }}
          echo ${{ steps.get_release.outputs.upload_url }}
          echo $(basename ${{ github.workspace }})
          for filename in ${{ github.workspace }}
          do
            echo $filename
          done;
